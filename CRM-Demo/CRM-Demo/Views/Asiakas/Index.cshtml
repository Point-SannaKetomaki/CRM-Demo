
@{
    ViewBag.Title = "Asiakkaat";
}

@section head{
}

@section scripts{
    <script type="text/javascript">
        $(document).ready(function () {

            function listaaAsiakastiedot() {

                //tuo asiakkaiden tiedot kontrollerilta
                $.getJSON("/Asiakas/GetList", null, function (json) {
                    var asiakkaat = JSON.parse(json)


                    //luodaan html-taulukon sisältörunko
                    var html = "";
                    for (var i = 0; i < asiakkaat.length; i++) {
                        //alert("Asiakkaan nimi: " + asiakkaat[i].Etunimi);
                        html += "<tr>" +
                            "<th scope ='row'></th>" +
                            "<td>" + asiakkaat[i].AsiakasId + "</td>" +
                            "<td>" + asiakkaat[i].Etunimi + "</td>" +
                            "<td>" + asiakkaat[i].Sukunimi + "</td>" +
                            "<td>" + asiakkaat[i].Osoite + "</td>" +
                            "<td>" + asiakkaat[i].Postinumero + "</td>" +
                            "<td>" + asiakkaat[i].Puhelin + "</td>" +
                            "<td>" + asiakkaat[i].Sähköposti + "</td>" +
                            "<td>" + asiakkaat[i].KategoriaId + "</td>" +
                            "<td>" + asiakkaat[i].Tila + "</td>" +
                            "<td><a href='#'><span class='fa fa-edit'></span></a></td>" +
                            "<td><a href='#'><span class='fa fa-trash'></span></a></td>" +
                            "</tr>\r\n"
                    }

                    //täytetään taulukko
                    $("#Listaustaulukko tbody").html(html);

                    //tietojen muokkaus
                    $(".fa-edit").click(function () {

                        //etsitään asiakkaan tiedot klikatulta riviltä
                        var asiakasId = $(this).parent().parent().prev().prev().prev().prev().prev().prev().prev().prev().prev().text();
                        alert(asiakasId);

                        //haetaan asiakkaan tiedot kontrollerilta id:n perusteella
                        $.getJSON("/Asiakas/GetSingleGroup/" + asiakasId, null, function (json2) {
                            var asiakas = JSON.parse(json2);

                            //tietojen lataus modaali-ikkunaan
                            $('#groupModal_AsiakasId').val(asiakas.AsiakasId)
                            $('#groupModal_Etunimi').val(asiakas.Etunimi)
                            $('#groupModal_Sukunimi').val(asiakas.Sukunimi)
                            $('#groupModal_Osoite').val(asiakas.Osoite)
                            $('#groupModal_Postinumero').val(asiakas.Postinumero)
                            $('#groupModal_Puhelin').val(asiakas.Puhelin)
                            $('#groupModal_Sähköposti').val(asiakas.Sähköposti)
                            $('#groupModal_KategoriaId').val(asiakas.KategoriaId)
                            $('#groupModal_Tila').val(asiakas.Tila)

                            //näytetään modaali-ikkuna
                            $('#groupModalTitle').text('Muokkaa asiakkaan tietoja');
                            $('#groupModalDialog').modal('show');
                        });
                    });
                });
            }

            //sivun alustus
            $(function () {
                $('#ListaaAsiakastiedot').on('click', function () {
                    listaaAsiakastiedot();
                });

                $('#LisääAsiakas').click(function () {

                    //tyhjennetään ikkunan tiedot
                    $('#groupModal_AsiakasId').val('(Uusi AsiakasId)');
                    $('#groupModal_Etunimi').val('');
                    $('#groupModal_Sukunimi').val('');
                    $('#groupModal_Osoite').val('');
                    $('#groupModal_Postinumero').val('');
                    $('#groupModal_Puhelin').val('');
                    $('#groupModal_Sähköposti').val('');
                    $('#groupModal_KategoriaId').val('');
                    $('#groupModal_Tila').val('');


                    //näytetään tyhjä modaali-ikkuna
                    $('#groupModalTitle').text('Lisää uusi asiakas');
                    $('#groupModalDialog').modal('show');
                });

                //Painetaan Tallenna => luetaan käyttäjän antamat tiedot modaali-ikkunasta
                $("#groupModalSaveButton").click(function () {
                    var details = {
                        AsiakasId: $("#groupModal_AsiakasId").val(),
                        Etunimi: $("#groupModal_Etunimi").val(),
                        Sukunimi: $("#groupModal_Sukunimi").val(),
                        Osoite: $("#groupModal_Osoite").val(),
                        Postinumero: $("#groupModal_Postinumero").val(),
                        Puhelin: $("#groupModal_Puhelin").val(),
                        Sähköposti: $("#groupModal_Sähköposti").val(),
                        KategoriaId: $("#groupModal_KategoriaId").val(),
                        Tila: $("#groupModal_Tila").val()
                    };

                    /*Lähetetään tiedot kontrollerille,
                     * annetaan käyttäjälle viesti päivityksen onnistumisesta,
                     * piilotetaan modaali-ikkuna ja
                     * päivitetään asiakasryhmälistaus*/
                    $.post("/Asiakas/Update/", details, function (status) {
                        if (status == true) {
                            alert('Uudet tiedot tallennettiin onnistuneesti');
                            $('#groupModalDialog').modal('hide');
                            listaaAsiakastiedot();
                        }
                        else {
                            alert('Tallennus ei valitettavasti onnistunut, tarkista tiedot!');
                        }

                    });
                });

            });


        });
    </script>
}

<h2>Asiakkaat</h2>

<div>
    <a class="btn btn-primary" href="#" role="button" id="LisääAsiakas">Lisää asiakas</a>
    <a class="btn btn-primary" href="#" role="button" id="PäivitäTaiPoista">Päivitä tai poista asiakas</a>
    <a class="btn btn-primary" href="#" role="button" id="LisääAsiakastapahtuma">Lisää asiakastapahtuma</a>
    <a class="btn btn-primary" href="#" role="button" id="ListaaAsiakastiedot">Listaa asiakastiedot</a>
</div>


<!-- Taulukko tietoja varten -->


<table class="table table-striped" id="Listaustaulukko">
    <thead class="thead-light">
        <tr>
            <th scope="col"></th>
            <th scope="col">AsiakasId</th>
            <th scope="col">Etunimi</th>
            <th scope="col">Sukunimi</th>
            <th scope="col">Osoite</th>
            <th scope="col">Postinumero</th>
            <th scope="col">Puhelin</th>
            <th scope="col">Sähköposti</th>
            <th scope="col">KategoriaId</th>
            <th scope="col">Tila</th>
            <th scope="col">Muokkaa</th>
            <th scope="col">Poista</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>


<!-- Modaali-ikkuna-->

<div class="modal" tabindex="-1" role="dialog" id="groupModalDialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><span id="groupModalTitle">Muokkaa asiakkaan tietoja</span></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-3">AsiakasId</div>
                    <div class="col-md-6"><input class="form-control" id="groupModal_AsiakasId" type="text" readonly></div>
                </div>
                <div class="row">
                    <div class="col-md-3">Etunimi</div>
                    <div class="col-md-6"><input class="form-control" id="groupModal_Etunimi" type="text"></div>
                </div>
                <div class="row">
                    <div class="col-md-3">Sukunimi</div>
                    <div class="col-md-6"><input class="form-control" id="groupModal_Sukunimi" type="text"></div>
                </div>
                <div class="row">
                    <div class="col-md-3">Osoite</div>
                    <div class="col-md-6"><input class="form-control" id="groupModal_Osoite" type="text"></div>
                </div>
                <div class="row">
                    <div class="col-md-3">Postinumero</div>
                    <div class="col-md-6"><input class="form-control" id="groupModal_Postinumero" type="text"></div>
                </div>
                <div class="row">
                    <div class="col-md-3">Puhelin</div>
                    <div class="col-md-6"><input class="form-control" id="groupModal_Puhelin" type="text"></div>
                </div>
                <div class="row">
                    <div class="col-md-3">Sähköposti</div>
                    <div class="col-md-6"><input class="form-control" id="groupModal_Sähköposti" type="text"></div>
                </div>
                <div class="row">
                    <div class="col-md-3">KategoriaId</div>
                    <div class="col-md-6"><input class="form-control" id="groupModal_KategoriaId" type="text"></div>
                </div>
                <div class="row">
                    <div class="col-md-3">Tila</div>
                    <div class="col-md-6"><input class="form-control" id="groupModal_Tila" type="text"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="groupModalSaveButton">Tallenna</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Sulje</button>

            </div>
        </div>
    </div>
</div>